# Supabase Configuration â€” SOW Generator Frontend

This document captures the current Supabase setup, tables, security policies, and frontend integration details.

Last updated: [auto-generated]

## Environment Variables (Frontend .env)

Required:
- REACT_APP_SUPABASE_URL=your-project-url
- REACT_APP_SUPABASE_KEY=your-anon-or-service-role-key

Recommended:
- REACT_APP_SITE_URL=https://your-local-or-prod-site-root (used for auth redirects if you enable auth flows)

Notes:
- These are build-time variables for Create React App (CRA). Rebuild after changes.

## Database Schema (public)

Tables created:

1) public.sows
- id: bigint generated by default as identity (primary key)
- title: text
- template: text
- content: text
- created_at: timestamptz not null default now()

2) public.templates
- id: uuid not null default gen_random_uuid() (primary key)
- name: text not null
- type: text
- body: text
- updated_at: timestamptz not null default now()

Extensions ensured:
- pgcrypto
- uuid-ossp

## Row Level Security (RLS)

RLS is enabled on:
- public.sows
- public.templates

Development policies (permissive; suitable for demos only):
- public.sows
  - "Anon read sows": SELECT using (true)
  - "Anon insert sows": INSERT with check (true)
- public.templates
  - "Anon read templates": SELECT using (true)
  - "Anon insert templates": INSERT with check (true)
  - "Anon update templates": UPDATE using (true) with check (true)
  - "Anon delete templates": DELETE using (true)

Important: Replace these with user-scoped policies in production, e.g.:
- using (auth.uid() is not null and created_by = auth.uid())
- with_check (auth.uid() is not null and created_by = auth.uid())

## Frontend Integration

Client initialization:
- src/supabaseClient.js uses createClient(REACT_APP_SUPABASE_URL, REACT_APP_SUPABASE_KEY).

Dynamic Site URL helper:
- src/utils/getURL.js provides a getURL() function to generate safe redirect URLs for auth flows.

Auth scaffolding (optional, recommended):
- src/pages/auth/AuthCallback.jsx included to process auth callback via getSessionFromUrl.
- If enabling magic link or OAuth, ensure Supabase Auth URL configuration includes:
  - Site URL: your domain (or http://localhost:3000 for dev)
  - Redirect URLs allowlist:
    - http://localhost:3000/**
    - https://yourapp.com/**

## Usage in Code

- Save SOW drafts:
  - src/pages/ExportPDF.jsx calls supabase.from("sows").insert([...])

- Manage templates:
  - src/pages/TemplatesManager.jsx performs CRUD on the "templates" table.

If you change table or column names, update the corresponding code paths.

## Post-Setup Checklist

1) In Supabase Dashboard:
- Authentication > URL Configuration:
  - Site URL set appropriately
  - Add http://localhost:3000/** and your production domain /** to Redirect URLs

2) Environment:
- Create .env from .env.example
- Set REACT_APP_SUPABASE_URL, REACT_APP_SUPABASE_KEY
- Optionally set REACT_APP_SITE_URL (used for auth redirects)

3) Rebuild Frontend:
- npm install
- npm start

## Security Notes

- Current policies permit anonymous read/write for ease of development.
- Before production:
  - Switch to authenticated flows.
  - Replace policies with user-restricted checks.
  - Consider adding created_by UUID columns referencing auth.uid() and use those in policies.
